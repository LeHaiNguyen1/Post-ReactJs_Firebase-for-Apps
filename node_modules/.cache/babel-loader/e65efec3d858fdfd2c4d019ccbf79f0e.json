{"ast":null,"code":"var _jsxFileName = \"/Users/lifetech/training-intern-032022/react-firestore/nguyenlehai/src/components/AddArticle.jsx\",\n    _s = $RefreshSig$();\n\nimport React, { useState } from \"react\";\nimport { addDoc, collection, Timestamp } from \"firebase/firestore\";\nimport { getDownloadURL, ref, uploadBytesResumable } from \"firebase/storage\";\nimport { auth, db, storage } from \"./../firebaseConfig\";\nimport { toast } from \"react-toastify\";\nimport { useAuthState } from \"react-firebase-hooks/auth\";\nimport { Link } from \"react-router-dom\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nexport default function AddArticle() {\n  _s();\n\n  const [user] = useAuthState(auth);\n  const [formData, setFormData] = useState({\n    title: \"\",\n    description: \"\",\n    image: \"\",\n    createdAt: Timestamp.now().toDate()\n  });\n  const [progress, setProgress] = useState(0);\n\n  const handleChange = e => {\n    setFormData({ ...formData,\n      [e.target.name]: e.target.value\n    });\n  };\n\n  const handleImageChange = e => {\n    setFormData({ ...formData,\n      image: e.target.files[0]\n    });\n  };\n\n  const handlePublish = () => {\n    if (!formData.title || !formData.description || !formData.image) {\n      alert(\"Please fill all the fields\");\n      return;\n    }\n\n    const storageRef = ref(storage, `/images/${Date.now()}${formData.image.name}`);\n    const uploadImage = uploadBytesResumable(storageRef, formData.image);\n    uploadImage.on(\"state_changed\", snapshot => {\n      const progressPercent = Math.round(snapshot.bytesTransferred / snapshot.totalBytes * 100);\n      setProgress(progressPercent);\n    }, err => {\n      console.log(err);\n    }, () => {\n      setFormData({\n        title: \"\",\n        description: \"\",\n        image: \"\"\n      });\n      getDownloadURL(uploadImage.snapshot.ref).then(url => {\n        const articleRef = collection(db, `posts/${user.uid}/userPost`);\n        addDoc(articleRef, {\n          title: formData.title,\n          description: formData.description,\n          imageUrl: url,\n          createdAt: Timestamp.now().toDate(),\n          createdBy: user.displayName,\n          userId: user.uid,\n          likes: []\n        }).then(() => {\n          toast(\"Article added successfully\", {\n            type: \"success\"\n          });\n          setProgress(0);\n        }).catch(err => {\n          toast(\"Error adding article\", {\n            type: \"error\"\n          });\n        });\n      });\n    });\n  };\n\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"border p-3 mt-3 bg-light\",\n    style: {\n      position: \"fixed\"\n    },\n    children: !user ? /*#__PURE__*/_jsxDEV(_Fragment, {\n      children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n        children: /*#__PURE__*/_jsxDEV(Link, {\n          to: \"/signin\",\n          children: \"Login to create post\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 87,\n          columnNumber: 25\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 86,\n        columnNumber: 21\n      }, this), \"Don't have an account? \", /*#__PURE__*/_jsxDEV(Link, {\n        to: \"/register\",\n        children: \"Signup\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 89,\n        columnNumber: 44\n      }, this)]\n    }, void 0, true) : /*#__PURE__*/_jsxDEV(_Fragment, {\n      children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n        children: \"Create post new\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 93,\n        columnNumber: 21\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"form-group\",\n        children: [/*#__PURE__*/_jsxDEV(\"label\", {\n          htmlFor: \"\",\n          children: \"Title\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 95,\n          columnNumber: 25\n        }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n          type: \"text\",\n          name: \"title\",\n          className: \"form-control\",\n          value: formData.title,\n          onChange: e => handleChange(e)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 96,\n          columnNumber: 25\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 94,\n        columnNumber: 21\n      }, this), /*#__PURE__*/_jsxDEV(\"label\", {\n        htmlFor: \"\",\n        children: \"Description\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 106,\n        columnNumber: 21\n      }, this), /*#__PURE__*/_jsxDEV(\"textarea\", {\n        name: \"description\",\n        className: \"form-control\",\n        value: formData.description,\n        onChange: e => handleChange(e)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 107,\n        columnNumber: 21\n      }, this), /*#__PURE__*/_jsxDEV(\"label\", {\n        htmlFor: \"\",\n        children: \"Image\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 115,\n        columnNumber: 21\n      }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n        type: \"file\",\n        name: \"image\",\n        accept: \"image/*\",\n        className: \"form-control\",\n        onChange: e => handleImageChange(e)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 116,\n        columnNumber: 21\n      }, this), progress === 0 ? null : /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"progress\",\n        children: /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"progress-bar progress-bar-striped mt-2\",\n          style: {\n            width: `${progress}%`\n          },\n          children: `uploading image ${progress}%`\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 126,\n          columnNumber: 29\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 125,\n        columnNumber: 25\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        className: \"form-control btn-primary mt-2\",\n        onClick: handlePublish,\n        children: \"Publish\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 134,\n        columnNumber: 21\n      }, this)]\n    }, void 0, true)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 83,\n    columnNumber: 9\n  }, this);\n}\n\n_s(AddArticle, \"XHU9jfOZkkCU4m8x/QnyU3gfjHA=\", false, function () {\n  return [useAuthState];\n});\n\n_c = AddArticle;\n\nvar _c;\n\n$RefreshReg$(_c, \"AddArticle\");","map":{"version":3,"sources":["/Users/lifetech/training-intern-032022/react-firestore/nguyenlehai/src/components/AddArticle.jsx"],"names":["React","useState","addDoc","collection","Timestamp","getDownloadURL","ref","uploadBytesResumable","auth","db","storage","toast","useAuthState","Link","AddArticle","user","formData","setFormData","title","description","image","createdAt","now","toDate","progress","setProgress","handleChange","e","target","name","value","handleImageChange","files","handlePublish","alert","storageRef","Date","uploadImage","on","snapshot","progressPercent","Math","round","bytesTransferred","totalBytes","err","console","log","then","url","articleRef","uid","imageUrl","createdBy","displayName","userId","likes","type","catch","position","width"],"mappings":"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","sourcesContent":["import React, {useState} from \"react\";\nimport {addDoc, collection, Timestamp} from \"firebase/firestore\";\nimport {getDownloadURL, ref, uploadBytesResumable} from \"firebase/storage\";\nimport {auth, db, storage} from \"./../firebaseConfig\";\nimport {toast} from \"react-toastify\";\nimport {useAuthState} from \"react-firebase-hooks/auth\";\nimport {Link} from \"react-router-dom\";\n\nexport default function AddArticle() {\n    const [user] = useAuthState(auth);\n    const [formData, setFormData] = useState({\n        title: \"\",\n        description: \"\",\n        image: \"\",\n        createdAt: Timestamp.now().toDate(),\n    });\n\n    const [progress, setProgress] = useState(0);\n\n    const handleChange = (e) => {\n        setFormData({...formData, [e.target.name]: e.target.value});\n    };\n\n    const handleImageChange = (e) => {\n        setFormData({...formData, image: e.target.files[0]});\n    };\n\n    const handlePublish = () => {\n        if (!formData.title || !formData.description || !formData.image) {\n            alert(\"Please fill all the fields\");\n            return;\n        }\n\n        const storageRef = ref(\n            storage,\n            `/images/${Date.now()}${formData.image.name}`\n        );\n\n        const uploadImage = uploadBytesResumable(storageRef, formData.image);\n\n        uploadImage.on(\n            \"state_changed\",\n            (snapshot) => {\n                const progressPercent = Math.round(\n                    (snapshot.bytesTransferred / snapshot.totalBytes) * 100\n                );\n                setProgress(progressPercent);\n            },\n            (err) => {\n                console.log(err);\n            },\n            () => {\n                setFormData({\n                    title: \"\",\n                    description: \"\",\n                    image: \"\",\n                });\n\n                getDownloadURL(uploadImage.snapshot.ref).then((url) => {\n                    const articleRef = collection(db, `posts/${user.uid}/userPost`);\n                    addDoc(articleRef, {\n                        title: formData.title,\n                        description: formData.description,\n                        imageUrl: url,\n                        createdAt: Timestamp.now().toDate(),\n                        createdBy: user.displayName,\n                        userId: user.uid,\n                        likes: [],\n                    })\n                        .then(() => {\n                            toast(\"Article added successfully\", {type: \"success\"});\n                            setProgress(0);\n                        })\n                        .catch((err) => {\n                            toast(\"Error adding article\", {type: \"error\"});\n                        });\n                });\n            }\n        );\n    };\n\n    return (\n        <div className=\"border p-3 mt-3 bg-light\" style={{position: \"fixed\"}}>\n            {!user ? (\n                <>\n                    <h2>\n                        <Link to=\"/signin\">Login to create post</Link>\n                    </h2>\n                    Don't have an account? <Link to=\"/register\">Signup</Link>\n                </>\n            ) : (\n                <>\n                    <h2>Create post new</h2>\n                    <div className=\"form-group\">\n                        <label htmlFor=\"\">Title</label>\n                        <input\n                            type=\"text\"\n                            name=\"title\"\n                            className=\"form-control\"\n                            value={formData.title}\n                            onChange={(e) => handleChange(e)}\n                        />\n                    </div>\n\n                    {/* description */}\n                    <label htmlFor=\"\">Description</label>\n                    <textarea\n                        name=\"description\"\n                        className=\"form-control\"\n                        value={formData.description}\n                        onChange={(e) => handleChange(e)}\n                    />\n\n                    {/* image */}\n                    <label htmlFor=\"\">Image</label>\n                    <input\n                        type=\"file\"\n                        name=\"image\"\n                        accept=\"image/*\"\n                        className=\"form-control\"\n                        onChange={(e) => handleImageChange(e)}\n                    />\n\n                    {progress === 0 ? null : (\n                        <div className=\"progress\">\n                            <div\n                                className=\"progress-bar progress-bar-striped mt-2\"\n                                style={{width: `${progress}%`}}\n                            >\n                                {`uploading image ${progress}%`}\n                            </div>\n                        </div>\n                    )}\n                    <button\n                        className=\"form-control btn-primary mt-2\"\n                        onClick={handlePublish}\n                    >\n                        Publish\n                    </button>\n\n\n                </>\n            )}\n        </div>\n    );\n}\n"]},"metadata":{},"sourceType":"module"}